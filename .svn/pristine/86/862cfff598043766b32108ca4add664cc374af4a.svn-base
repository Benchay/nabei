<template>
    <div class="fillcontain">
        <div class="homeSeller">
            <el-col :span="15" class="isLeft">
                <div class="leftStatistics">
                    <div class="flex">
                        <img src="../image/ssfunction.png" alt="">
                        <p class="title">常用功能</p>
                    </div>
                    <div class="leftFunction">
                        <ul class="flex2">
                            <li>
                                <router-link :to='{path:"/addShop"}'>
                                <div>
                                    <div class="icon1 icon"><img src="../image/sy_icon01.png" alt=""></div>
                                    <div>绑定店铺</div>
                                </div>
                                </router-link>
                            </li>
                            <li>
                                <router-link :to='{path:"/packageDetails"}'>
                                <div>
                                    <div class="icon2 icon"><img src="../image/sy_icon02.png" alt=""></div>
                                    <div>包裹管理</div>
                                </div>
                                </router-link>
                            </li>
                            <li>
                                <router-link :to='{path:"/salesReturn"}'>
                                <div>
                                    <div class="icon3 icon"><img src="../image/sy_icon03.png" alt=""></div>
                                    <div>退货管理</div>
                                </div>
                                </router-link>
                            </li>
                            <li>
                                <router-link :to='{path:"/stallSettlement"}'>
                                <div>
                                    <div class="icon4 icon"><img src="../image/sy_icon04.png" alt=""></div>
                                    <div>档口结算</div>
                                </div>
                                </router-link>
                            </li>
                            <li>
                                <router-link :to='{path:"/financialManagement2"}'>
                                <div>
                                    <div class="icon5 icon"><img src="../image/sy_icon05.png" alt=""></div>
                                    <div>财务交易记录</div>
                                </div>
                                </router-link>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="leftStatistics">
                   <div class="flex" style="border-bottom:1px solid #d7d7d7;padding-bottom: 5px">
                       <div class="flex">
                           <img src="../image/statistics.png" alt="">
                           <p class="title">数据统计</p>
                       </div>
                       <ul class="flex">
                           <li v-for="(obj,index) in items" @click="salesTabs(index)"><a href="javascript:void(0)" :class="{'checked':index === clickIndex}" class="cheked1">{{obj.title}}</a></li>
                       </ul>
                   </div>
                    <ul class="leftStatisticsList flex">
                        <li>
                            <div>
                                <div>待采商品数（个）</div>
                                <div class="bigText">{{this.formatData(this.purchaseRequireVO.requireCnt)}}</div>
                                <div><img :src="formatImages(this.purchaseRequireVO.requireCntChangeRate)" alt=""><span :class="[upDescend == 1?'up':upDescend == 2?'descend':'']">{{this.requireCntChangeRate}}%</span>{{this.title}}</div>
                            </div>
                        </li>
                        <li>
                            <div>
                                <div>采购订单数数（个）</div>
                                <div class="bigText">{{this.formatData(this.purchaseRequireVO.orderNum)}}</div>
                                <div><img :src="formatImages(this.purchaseRequireVO.orderNumChangeRate)" alt=""><span :class="[upDescend == 1?'up':upDescend == 2?'descend':'']">{{this.orderNumChangeRate}}%</span>{{this.title}}</div>
                            </div>
                        </li>
                        <li>
                            <div>
                                <div>采购金额（元）</div>
                                <div class="bigText">{{this.formatData(this.purchaseRequireVO.totalFee)}}</div>
                                <div><img :src="formatImages(this.purchaseRequireVO.totalFeeChangeRate)" alt=""><span :class="[upDescend == 1?'up':upDescend == 2?'descend':'']">{{this.totalFeeChangeRate}}%</span>{{this.title}}</div>
                            </div>
                        </li>
                        <li>
                            <div>
                                <div>商品（个）</div>
                                <div class="bigText">{{this.formatData(this.purchaseRequireVO.totalNum)}}</div>
                                <div><img :src="formatImages(this.purchaseRequireVO.totalNumChangeRate)" alt=""><span :class="[upDescend == 1?'up':upDescend == 2?'descend':'']">{{this.totalNumChangeRate}}%</span>{{this.title}}</div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="stallData" style="width:96%;overflow: auto">
                    <div class="stallDataTitle">
                        <p class="left">销售数据</p>
                        <el-radio-group v-model="radio3" size="small" class="right radioRed">
                            <el-radio-button label="1">七天</el-radio-button>
                            <el-radio-button label="2">一个月</el-radio-button>
                            <el-radio-button label="3">三个月</el-radio-button>
                        </el-radio-group>
                    </div>
                    <div class="stallDataButton">
                        <ul class="flex">
                            <li v-for="(obj,index) in itemss" @click="salesTabss(index)"  :class="{'change2':index === clickIndex2}">
                                <a href="javascript:void(0)">{{obj}}</a>
                            </li>
                        </ul>
                    </div>
                    <stockedLine :lineData="lineData" :lineUnit="lineUnit" :numData="numData" :typeName="typeName" :lineColor="lineColor"></stockedLine>
                </div>
            </el-col>
            <el-col :span="9" class="isRight">
                <div class="newNotice">
                   <div class="flex">
                       <img src="../image/tmessage03.png" alt="">
                       <p class="title">最新公告</p>
                   </div>
                    <ul class="noticeList" >
                        <li v-for="item in bulletins">{{item.label}}</li>
                    </ul>
                    <div class="right noticeButton"><router-link :to='{path:"/systemNotice",query:{applicationId:"5"}}'>查看更多 》</router-link></div>
                </div>
                <div class="newDynamic">
                    <div class="flex">
                        <img src="../image/tmessage03.png" alt="">
                        <p class="title">近期动态</p>
                    </div>
                    <ul class="DynamicList">
                        <li class="flex" v-for="item in notifyInfo">
                            <div class="listHead">
                                <img src="../image/sprite01.png" alt="">
                            </div>
                            <div class="state">
                                <p class="flex"><span class="listState">{{checkStatus(item.messageType)}}</span><span class="listNum">{{item.companyName}}</span></p>
                                <p class="flex"><span class="listState">{{formatDate(item.createTime)}}</span><span class="listNum">订单编号：{{checkOrderCode(item.message)}}</span></p>
                            </div>
                        </li>
                    </ul>
                    <!--<div class="right noticeButton"><router-link :to='{path:"/moreDynamic",query:{companyId:this.roleForm.compId}}'>查看更多 》</router-link></div>-->
                    <div class="right noticeButton"><router-link :to='{path:"/messageCenter"}'>查看更多 》</router-link></div>
                </div>
                <router-link :to='{path:"/sellerIntroduction"}' class="greenHand">
                    <div>
                        <p class="title">新手入门</p>
                        <div class="greenHandImg">
                            <img src="../image/timg2.png" alt="">
                        </div>
                    </div>
                </router-link>
            </el-col>
        </div>
    </div>
</template>

<script>
	import {apiCount, userCount, orderCount, apiAllCount, getUserCount, getOrderCount, adminDayCount, adminCount,statisticsPurchaseInfo,queryBulletin,queryOrderLog,queryWorkMessageLog} from '@/api/getData'
    import {getStore} from  '../config/mUtils'
    import {formatDate} from '../utils/date.js'
    import stockedLine from '../components/stockedLine'
    import {isNullObject} from '../utils/common.js'

    export default {
        components: {
            stockedLine
        },
    	data(){
    		return {
                roleForm: {
                    userId: '',
                    roleId: '',
                    compId:''
                },
                clickIndex:0,
                items:[
                    {title:'今日'},
                    {title:'本周'},
                    {title:'本月'},
                ],
                title:'',
                upDescend:1,
                purchaseRequireVO:'',
                bulletins:[],
                image_up:require("../image/up.png"),
                image_descend:require("../image/descend.png"),
                pageIndex:1,
                pageSize:8,
                requireCntChangeRate:'',
                totalNumChangeRate:'',
                totalFeeChangeRate:'',
                orderNumChangeRate:'',
                orderLogList:'',
                clickIndex2:0,
                radio3:1,
                //线形图数据
                lineData:[
                    ['10-01'],
                    ['10-02'],
                    ['10-03'],
                    ['10-04'],
                    ['10-05'],
                    ['10-06'],
                    ['10-07']],
                numData:[20, 132, 101, 134, 90, 230, 210],
                lineUnit:'',
                typeName:'',
                lineColor:'#da444f',
                itemss:['采购','退货'],
                notifyInfo:''
    		}
    	},
        mounted(){
            var userInfo=getStore("user_info_user");
            var vjson = JSON.parse(userInfo);
            this.roleForm.userId=vjson.id;
            //this.roleForm.compId=vjson.curCompany.id;
			const currentComp = getStore("curCompany");console.log(currentComp);
            if(!isNullObject(currentComp)){
                const vcom = JSON.parse(currentComp);
                this.roleForm.compId = vcom.id;
            }
            this.title = '环比昨日';
    	    let param = {
    	        "checkedDate":'1',
                "companyId":this.roleForm.compId
            };
    	    this.loadPurchaseInfo(param);//采购信息统计

    	    let bulletinParam = {
    	        "applicationId":'5',
                "pageIndex":this.pageIndex,
                "pageSize":3
            };
    	    this.loadBulletinInfo(bulletinParam);//公告信息


            let pa = {
                "companyId":this.roleForm.compId,
                "createUserId":this.roleForm.userId,
                "pageIndex":1,
                "pageSize":3,
                "read":0
            };
            this.loadWorkMessage(pa);

//            let pa = {
//                "companyId":this.roleForm.compId,
//                "pageIndex":1,
//                "pageSize":3
//            };
//            this.loadOrderLogInfo(pa);
        },
    	methods: {
            salesTabss(index){
                this.clickIndex2 = index;
            },

            salesTabs(index) {
                this.clickIndex = index;
                if(this.clickIndex==0){
                    this.title = '环比昨日';
                    let param = {
                        "checkedDate":'1',
                        "companyId":this.roleForm.compId
                    };
                    this.loadPurchaseInfo(param);
                }else if(this.clickIndex ==1){
                    this.title = '环比上周';
                    let param = {
                        "checkedDate":'7',
                        "companyId":this.roleForm.compId
                    };
                    this.loadPurchaseInfo(param);
                }else if(this.clickIndex ==2){
                    this.title = '环比上月';
                    let param = {
                        "checkedDate":'30',
                        "companyId":this.roleForm.compId
                    };
                    this.loadPurchaseInfo(param);
                }
            },

            async loadPurchaseInfo(param){
                const res = await statisticsPurchaseInfo(param);
                if(res.isSuccess){
                	if(res.result.data!=null){
                		this.purchaseRequireVO = res.result.data;
                    	this.requireCntChangeRate = this.formatNum(this.purchaseRequireVO.requireCntChangeRate);
	                    this.totalNumChangeRate = this.formatNum(this.purchaseRequireVO.totalNumChangeRate);
	                    this.totalFeeChangeRate = this.formatNum(this.purchaseRequireVO.totalFeeChangeRate);
	                    this.orderNumChangeRate = this.formatNum(this.purchaseRequireVO.orderNumChangeRate);	
                	}
                }else{
                    this.$message({
                        type:'error',
                        message:res.errorMsg
                    });
                }
            },

            async loadBulletinInfo(param){
                const res = await queryBulletin(param);
                if(res.isSuccess){
                    let data = res.result.data;
                    for(let i = 0;i<data.length;i++){
                        let pa = {
                            "label":'【'+ this.formatDate(data[i].createTime) + '】' + '公告标题：' + data[i].title,
                            "value":data[i].id
                        };
                        this.bulletins.push(pa);
                    }
                }else{
                    this.$message({
                        type:'error',
                        message:res.errorMsg
                    });
                }
            },

            //查询订单动态
            async loadOrderLogInfo(param){
                this.orderLogList = [];
                const res = await queryOrderLog(param);
                if(res.isSuccess){
                    this.orderLogList = res.result.results;
                }else{
                    this.$message({
                        type:'error',
                        message:res.errorMsg
                    });
                }
            },

            //查询消息
            async loadWorkMessage(param){
                const  res = await queryWorkMessageLog(param);
                if(res.isSuccess){
                    this.notifyInfo = res.result.results;
//                    let obj = eval('(' + this.notifyInfo[0].message + ')');
//                    alert(2);
//                    alert('1---'+obj.orderCode);
                }
            },

            checkStatus(messageType){
                if(messageType =="0"){
                    return "提醒配货";
                }else if(messageType =="1"){
                    return "提醒拿货";
                }else if(messageType =="2"){
                    return "发起结算提醒";
                }else if(messageType =="3"){
                    return "待配货";
                }else if(messageType =="4"){
                    return "部分待配货";
                }else if(messageType =="5"){
                    return "退货待入库 ";
                }else if(messageType =="6"){
                    return "退货待确认";
                }else if(messageType =="7"){
                    return "退货待签收";
                }else if(messageType =="8"){
                    return "确认收款";
                }else if(messageType =="9"){
                    return "采购待签收";
                }else if(messageType =="10"){
                    return "待入库";
                }else if(messageType =="11"){
                    return "等待装车";
                }else if(messageType =="12"){
                    return "等待拿货";
                }else if(messageType =="13"){
                    return "发起收款";
                }else if(messageType =="14"){
                    return "确认收款";
                }else if(messageType =="15"){
                    return "已拿货";
                }
            },

            checkOrderCode(val){
                let obj = eval('(' + val + ')');
                return obj.orderCode;
            },

            formatData(data){
                if(data==''){
                    return "0";
                }else{
                    return data;
                }
            },

            //数据格式化
            formatDate:function(date) {
                if (date == undefined||date=='') {
                    return "";
                }
                var date2 = new Date(date);
                return formatDate(date2,'yyyy-MM-dd');
            },

            formatImages(param){
                if(param>0){
                    this.upDescend = 1;
                    return this.image_up;
                }else if(param<0){
                    this.upDescend = 2;
                    return this.image_descend;
                }

            },

            formatNum(param){
                if(param==undefined){
                    return "0";
                }
                if(param<0){
                    return -param;
                }else{
                    return param;
                }
            }
    	}
    }
</script>

<style lang="less">
	@import '../style/mixin';
	@import "../style/common";
    @import "../style/homeSeller";

</style>
